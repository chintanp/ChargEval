# This file describes the algorithm for finding the charging distances for an OD pair. 

Charging Distance (CD) is defined as the maximum distance between charging stations along a route. CD is needed in the vehicle choice decision model (VCDM). The idea of CD is that if the CD along any route is greater than the range of a vehicle, then the vehicle get stranded along the route. While the CD is a route property, it is specific to a charging standard, i.e. the CD maybe different for CHAdeMO and COMBO vehicles. 

The calculation of CD is separately done for CHAdeMO and COMBO chargers, since the two are unrelated. While theoretically it is possible to perform the CD calculation for all 300k+ OD pairs in the state of WA using `psql`, a combination of `R` and `psql` is used here for the ease of implementation and readability. Performance improvements are likely if use of R is eliminated.

For calculating CD CHAdeMO:
1. Loop through the list of OD pairs in R parallely. Since the calculation of CD is independent for all paths, they can be run in parallel.
2. For the current OD pair, compute shortest path using the Dijkstra's one-to-one algorithm using psql (PostGIS, pgRouting).
3. Using PostGIS find the set of charging stations that are within a certain distance of the shortest path. These are the relevant charging stations for the OD pair/path. 
4. Using PostGIS find the proportion of the line at which the closest-point to a charging stations on the path is located for all charging stations. 
5. Sort the proportions in R. 
6. Find the difference between adjacent values in R. 
7. Find the maximum difference. The maximum proportion difference refers to the CD sub-section of the path.
8. The product of the maximum difference and shortest path length gets us the CD. 
9. Store the calculated CD to the database along with the origin and destination.
10. Repeat the procedure for COMBO vehicles.